temp=$(tty) ;
TTY=${temp:9}

bash_prompt() {
    local RET=$?        # set return value of last command MUST BE FIRST
    local USERCOLOR="\[\e[38;5;81m\]"
    local DIRCOLOR="\[\e[1;34m\]"
    local BOLDRED="\[\e[1;31m\]"

    local val=$(hostname)
    local val_regex="[a-fA-F0-9]{${#val}}"
    if ! [[ ${val} =~ $val_regex ]]; then
       local a=${val}
       val=$(for ((i=0;i<${#a};i++));do printf %02X \'${a:$i:1};done)
    fi

    # clean up numbers that'll display poorly
    while [[ ${val:0:2} =~ (00.*|[1][0-5].*|e[7-f].*) ]]; do val=${val:2};done;
    while [[ ${val:2:2} =~ (00.*|[1][0-5].*|e[7-f].*) ]]; do val=${val:0:2}${val:4};done;
    


    if [[ ${val:0:2} =~ [A-F0-9a-f][A-F0-9a-f].* ]]; then
        USERCOLOR=$(printf '\[\e[38;5;%dm\]' 0x${val:0:2}) ;
    fi
    if [[ ${val:2:2} =~ [A-F0-9a-f][A-F0-9a-f].* ]]; then
        DIRCOLOR=$(printf '\[\e[38;5;%dm\]' 0x${val:2:2}) ;
    fi

    local NONE="\[\e[0m\]"    # unsets color to term's fg color

    local VENV=""
    if [ ! -z ${VIRTUAL_ENV+x} ];
        then local VENV=" [$(basename $VIRTUAL_ENV)]";
    fi
    local RET_STR="${NONE}# "

    [ $RET -ne 0 ] && RET_STR="${BOLDRED}($RET)${NONE} "
    local showip="-${LAST_IP}"
    PS1="${USERCOLOR}\u@\h${showip}${VENV} ${DIRCOLOR}\w ${RET_STR}"

}
PROMPT_COMMAND=bash_prompt

